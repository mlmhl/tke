import React, { useRef } from "react";
import { CSSTransition } from "react-transition-group";
import { TransitionProps } from "react-transition-group/Transition";
import { noop } from "../_util/noop";

export function BaseTransition({
  in: enter,
  onExit = noop,
  onExited = noop,
  children,
  ...props
}: TransitionProps) {
  // 离场时保持 children 不变
  const childrenRef = useRef<React.ReactNode>(null);

  return (
    <CSSTransition
      {...props}
      in={enter}
      onExit={(...args) => {
        childrenRef.current = children;
        onExit(...args);
      }}
      onExited={(...args) => {
        childrenRef.current = null;
        onExited(...args);
      }}
    >
      {childrenRef.current || children}
    </CSSTransition>
  );
}
