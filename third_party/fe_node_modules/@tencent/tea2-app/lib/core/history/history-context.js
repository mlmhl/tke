"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var react_1 = __importDefault(require("react"));
var useContext = react_1.default.useContext, useEffect = react_1.default.useEffect;
// 使用 Context 提供 history，以及设置 conformation 的方法
exports.HistoryContext = react_1.default.createContext(null);
exports.HistoryContext.displayName = "Tea.History";
/**
 * 使用适配控制台的 history（React Hooks）
 *
 * 具体使用方法请参考 http://tapd.oa.com/QCloud_2015/markdown_wikis/view/#1010103951008571667
 *
 * @param getConfirmation (experimental) 路由切换前，让用户确认
 *
 * @example
```js
import React from 'react';
import { Router, Route, Link } from 'react-router-dom';
import { useHistory } from '@tea/app';
import { CvmDetailInstance } from './components';

export function CvmDetail() {
  // 此处为 React Hooks，只能在 Function Component 中使用
  const history = useHistory();

  return (
    <Router history={history}>
      <div>
        <Link to="/cvm/detail/ins-1q2w3e4r">ins-1q2w3e4r</Link>
        <Route path="/cvm/detail/:instanceId" component={CvmDetailInstance}></Route>
      </div>
    </Router>
  );
}
```
 */
exports.useHistory = function (getConfirmation) {
    var _a = useContext(exports.HistoryContext), history = _a.history, setConfirmation = _a.setConfirmation;
    // 设置提供的确认函数
    useEffect(function () {
        if (getConfirmation) {
            setConfirmation(getConfirmation);
        }
        return function () { return setConfirmation(null); };
    }, []);
    return history;
};
// TODO 转移 Ref
// dev 模式下最外层组件使用转移 Ref 的 HOC 导致异常
function withHistory(WrappedComponent) {
    function TeaHistoryHoc(props) {
        var history = exports.useHistory();
        return react_1.default.createElement(WrappedComponent, __assign({}, props, { history: history }));
    }
    return TeaHistoryHoc;
}
exports.withHistory = withHistory;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGlzdG9yeS1jb250ZXh0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NvcmUvaGlzdG9yeS9oaXN0b3J5LWNvbnRleHQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLGdEQUEwQjtBQUVsQixJQUFBLHVDQUFVLEVBQUUscUNBQVMsQ0FBVztBQVN4Qyw4Q0FBOEM7QUFDakMsUUFBQSxjQUFjLEdBQUcsZUFBSyxDQUFDLGFBQWEsQ0FBc0IsSUFBSSxDQUFDLENBQUM7QUFFN0Usc0JBQWMsQ0FBQyxXQUFXLEdBQUcsYUFBYSxDQUFDO0FBRTNDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBNEJHO0FBQ1UsUUFBQSxVQUFVLEdBQUcsVUFBQyxlQUE4QjtJQUNqRCxJQUFBLHVDQUF5RCxFQUF2RCxvQkFBTyxFQUFFLG9DQUE4QyxDQUFDO0lBRWhFLFlBQVk7SUFDWixTQUFTLENBQUM7UUFDUixJQUFJLGVBQWUsRUFBRTtZQUNuQixlQUFlLENBQUMsZUFBZSxDQUFDLENBQUM7U0FDbEM7UUFDRCxPQUFPLGNBQU0sT0FBQSxlQUFlLENBQUMsSUFBSSxDQUFDLEVBQXJCLENBQXFCLENBQUM7SUFDckMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBRVAsT0FBTyxPQUFPLENBQUM7QUFDakIsQ0FBQyxDQUFDO0FBRUYsY0FBYztBQUNkLGtDQUFrQztBQUNsQyxTQUFnQixXQUFXLENBQ3pCLGdCQUFtQjtJQUVuQixTQUFTLGFBQWEsQ0FBQyxLQUFLO1FBQzFCLElBQU0sT0FBTyxHQUFHLGtCQUFVLEVBQUUsQ0FBQztRQUM3QixPQUFPLGVBQUssQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLGVBQU8sS0FBSyxJQUFFLE9BQU8sU0FBQSxJQUFHLENBQUM7SUFDdEUsQ0FBQztJQUNELE9BQVEsYUFBMEIsQ0FBQztBQUNyQyxDQUFDO0FBUkQsa0NBUUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgeyBIaXN0b3J5IH0gZnJvbSBcImhpc3RvcnlcIjtcbmNvbnN0IHsgdXNlQ29udGV4dCwgdXNlRWZmZWN0IH0gPSBSZWFjdDtcblxuZXhwb3J0IHR5cGUgQ29uZmlybWF0aW9uID0gdHlwZW9mIGltcG9ydChcImhpc3RvcnkvRE9NVXRpbHNcIikuZ2V0Q29uZmlybWF0aW9uO1xuXG5pbnRlcmZhY2UgSGlzdG9yeUNvbnRleHRWYWx1ZSB7XG4gIGhpc3Rvcnk6IEhpc3Rvcnk7XG4gIHNldENvbmZpcm1hdGlvbjogKGNvbmZpcm1hdGlvbjogQ29uZmlybWF0aW9uKSA9PiB2b2lkO1xufVxuXG4vLyDkvb/nlKggQ29udGV4dCDmj5DkvpsgaGlzdG9yee+8jOS7peWPiuiuvue9riBjb25mb3JtYXRpb24g55qE5pa55rOVXG5leHBvcnQgY29uc3QgSGlzdG9yeUNvbnRleHQgPSBSZWFjdC5jcmVhdGVDb250ZXh0PEhpc3RvcnlDb250ZXh0VmFsdWU+KG51bGwpO1xuXG5IaXN0b3J5Q29udGV4dC5kaXNwbGF5TmFtZSA9IFwiVGVhLkhpc3RvcnlcIjtcblxuLyoqXG4gKiDkvb/nlKjpgILphY3mjqfliLblj7DnmoQgaGlzdG9yee+8iFJlYWN0IEhvb2tz77yJXG4gKlxuICog5YW35L2T5L2/55So5pa55rOV6K+35Y+C6ICDIGh0dHA6Ly90YXBkLm9hLmNvbS9RQ2xvdWRfMjAxNS9tYXJrZG93bl93aWtpcy92aWV3LyMxMDEwMTAzOTUxMDA4NTcxNjY3XG4gKlxuICogQHBhcmFtIGdldENvbmZpcm1hdGlvbiAoZXhwZXJpbWVudGFsKSDot6/nlLHliIfmjaLliY3vvIzorqnnlKjmiLfnoa7orqRcbiAqXG4gKiBAZXhhbXBsZVxuYGBganNcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBSb3V0ZXIsIFJvdXRlLCBMaW5rIH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSc7XG5pbXBvcnQgeyB1c2VIaXN0b3J5IH0gZnJvbSAnQHRlYS9hcHAnO1xuaW1wb3J0IHsgQ3ZtRGV0YWlsSW5zdGFuY2UgfSBmcm9tICcuL2NvbXBvbmVudHMnO1xuXG5leHBvcnQgZnVuY3Rpb24gQ3ZtRGV0YWlsKCkge1xuICAvLyDmraTlpITkuLogUmVhY3QgSG9va3PvvIzlj6rog73lnKggRnVuY3Rpb24gQ29tcG9uZW50IOS4reS9v+eUqFxuICBjb25zdCBoaXN0b3J5ID0gdXNlSGlzdG9yeSgpO1xuXG4gIHJldHVybiAoXG4gICAgPFJvdXRlciBoaXN0b3J5PXtoaXN0b3J5fT5cbiAgICAgIDxkaXY+XG4gICAgICAgIDxMaW5rIHRvPVwiL2N2bS9kZXRhaWwvaW5zLTFxMnczZTRyXCI+aW5zLTFxMnczZTRyPC9MaW5rPlxuICAgICAgICA8Um91dGUgcGF0aD1cIi9jdm0vZGV0YWlsLzppbnN0YW5jZUlkXCIgY29tcG9uZW50PXtDdm1EZXRhaWxJbnN0YW5jZX0+PC9Sb3V0ZT5cbiAgICAgIDwvZGl2PlxuICAgIDwvUm91dGVyPlxuICApO1xufVxuYGBgXG4gKi9cbmV4cG9ydCBjb25zdCB1c2VIaXN0b3J5ID0gKGdldENvbmZpcm1hdGlvbj86IENvbmZpcm1hdGlvbikgPT4ge1xuICBjb25zdCB7IGhpc3RvcnksIHNldENvbmZpcm1hdGlvbiB9ID0gdXNlQ29udGV4dChIaXN0b3J5Q29udGV4dCk7XG5cbiAgLy8g6K6+572u5o+Q5L6b55qE56Gu6K6k5Ye95pWwXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGdldENvbmZpcm1hdGlvbikge1xuICAgICAgc2V0Q29uZmlybWF0aW9uKGdldENvbmZpcm1hdGlvbik7XG4gICAgfVxuICAgIHJldHVybiAoKSA9PiBzZXRDb25maXJtYXRpb24obnVsbCk7XG4gIH0sIFtdKTtcblxuICByZXR1cm4gaGlzdG9yeTtcbn07XG5cbi8vIFRPRE8g6L2s56e7IFJlZlxuLy8gZGV2IOaooeW8j+S4i+acgOWkluWxgue7hOS7tuS9v+eUqOi9rOenuyBSZWYg55qEIEhPQyDlr7zoh7TlvILluLhcbmV4cG9ydCBmdW5jdGlvbiB3aXRoSGlzdG9yeTxDIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50Q2xhc3M8YW55Pj4oXG4gIFdyYXBwZWRDb21wb25lbnQ6IENcbik6IEMge1xuICBmdW5jdGlvbiBUZWFIaXN0b3J5SG9jKHByb3BzKSB7XG4gICAgY29uc3QgaGlzdG9yeSA9IHVzZUhpc3RvcnkoKTtcbiAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChXcmFwcGVkQ29tcG9uZW50LCB7IC4uLnByb3BzLCBoaXN0b3J5IH0pO1xuICB9XG4gIHJldHVybiAoVGVhSGlzdG9yeUhvYyBhcyBhbnkpIGFzIEM7XG59XG4iXX0=